<div class="container py-4">

  <!-- TÍTULO -->
  <h3 class="fw-bold text-primary mb-4">
    <i class="bi bi-book me-2"></i>
    Cadastro de Livros
  </h3>

  <!-- FORM -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      <strong>
        <i class="bi bi-pencil-square me-1"></i>
        @if (editando) { Editar Livro } @else { Novo Livro }
      </strong>
    </div>

    <div class="card-body">

      @if (erro) {
        <div class="alert alert-danger">
          <i class="bi bi-exclamation-triangle me-1"></i>
          {{ erro }}
        </div>
      }

      <form (ngSubmit)="salvar()" class="row g-3">

        <!-- TÍTULO -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">Título</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="livroForm.titulo"
            name="titulo"
            required
          />
        </div>

        <!-- EDITORA -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">Editora</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="livroForm.editora"
            name="editora"
            required
          />
        </div>

        <!-- EDIÇÃO -->
        <div class="col-md-3">
          <label class="form-label fw-semibold">Edição</label>
          <input
            type="number"
            min="1"
            class="form-control"
            [(ngModel)]="livroForm.edicao"
            name="edicao"
            required
          />
        </div>

        <!-- ANO -->
        <div class="col-md-3">
          <label class="form-label fw-semibold">Ano Publicação</label>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="livroForm.anoPublicacao"
            name="anoPublicacao"
            required
          />
        </div>

        <!-- VALOR -->
        <div class="col-md-3">
          <label class="form-label fw-semibold">Valor (R$)</label>
          <input
            type="number"
            step="0.01"
            min="0"
            class="form-control"
            [(ngModel)]="livroForm.valor"
            name="valor"
            required
          />
        </div>

        <!-- AUTORES -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">Autores</label>
          <select
            class="form-select"
            multiple
            [(ngModel)]="livroForm.autoresIds"
            name="autoresIds"
            required
          >
            @for (autor of autores(); track autor.id) {
              <option [value]="autor.id">
                {{ autor.nome }}
              </option>
            }
          </select>
          <small class="text-muted">Segure Ctrl para selecionar vários</small>
        </div>

        <!-- ASSUNTOS -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">Assuntos</label>
          <select
            class="form-select"
            multiple
            [(ngModel)]="livroForm.assuntosIds"
            name="assuntosIds"
            required
          >
            @for (assunto of assuntos(); track assunto.id) {
              <option [value]="assunto.id">
                {{ assunto.descricao }}
              </option>
            }
          </select>
          <small class="text-muted">Segure Ctrl para selecionar vários</small>
        </div>

        <!-- BOTÕES -->
        <div class="col-12 d-flex justify-content-end gap-2 mt-3">
          <button class="btn btn-success">
            <i class="bi bi-save me-1"></i>
            @if (editando) { Atualizar } @else { Salvar }
          </button>

          <button
            type="button"
            class="btn btn-outline-secondary"
            (click)="resetForm()"
          >
            <i class="bi bi-x-circle me-1"></i>
            Cancelar
          </button>
        </div>

      </form>
    </div>
  </div>

  <!-- TABELA -->
  <div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
      <strong>
        <i class="bi bi-table me-1"></i>
        Livros Cadastrados
      </strong>
    </div>

    <div class="table-responsive">
      <table class="table table-hover table-striped align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Título</th>
            <th>Editora</th>
            <th>Autores</th>
            <th>Assuntos</th>
            <th class="text-center" style="width: 140px">Ações</th>
          </tr>
        </thead>

        <tbody>
          @for (livro of livros(); track livro.codl) {
            <tr>
              <td class="fw-semibold">{{ livro.titulo }}</td>

              <td>{{ livro.editora }}</td>

              <td>
                @for (a of livro.autores; track a.id) {
                  <span class="badge bg-secondary me-1">
                    {{ a.nome }}
                  </span>
                }
              </td>

              <td>
                @for (s of livro.assuntos; track s.id) {
                  <span class="badge bg-info me-1">
                    {{ s.descricao }}
                  </span>
                }
              </td>

              <td class="text-center">
                <div class="btn-group btn-group-sm">
                  <button
                    class="btn btn-outline-warning"
                    (click)="editar(livro)"
                    title="Editar"
                  >
                    <i class="bi bi-pencil"></i>
                  </button>

                  <button
                    class="btn btn-outline-danger"
                    (click)="excluir(livro)"
                    title="Excluir"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          }

          @if (livros().length === 0) {
            <tr>
              <td colspan="5" class="text-center text-muted py-4">
                <i class="bi bi-inbox fs-3 d-block"></i>
                Nenhum livro cadastrado
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

</div>
